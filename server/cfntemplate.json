{
        "Description": "Top Secret stack",

        "Resources": {

                "MessageTable": {
                        "Type" : "AWS::DynamoDB::Table",
                        "Properties" : {
                                "AttributeDefinitions" : [
                                        {
                                                "AttributeName": "id",
                                                "AttributeType": "S"
                                        },
                                        {
                                                "AttributeName": "email",
                                                "AttributeType": "S"
                                        }
                                ],
                                "GlobalSecondaryIndexes" : [
                                        {
                                                "IndexName": "email-index",
                                                "KeySchema": [
                                                        {
                                                                "AttributeName": "email",
                                                                "KeyType": "HASH"
                                                        }
                                                ],
                                                "Projection": {
                                                        "ProjectionType": "KEYS_ONLY"
                                                },
                                                "ProvisionedThroughput": {
                                                        "ReadCapacityUnits": 5,
                                                        "WriteCapacityUnits": 5
                                                }
                                        }
                                ],
                                "KeySchema" : [
                                        {
                                                "AttributeName": "id",
                                                "KeyType": "HASH"
                                        }
                                ],
                                "ProvisionedThroughput" : {
                                        "ReadCapacityUnits": 5,
                                        "WriteCapacityUnits": 5
                                },
                                "TableName" : "message-dev"
                        }
                },

                "PlayerTable": {
                        "Type" : "AWS::DynamoDB::Table",
                        "Properties" : {
                                "AttributeDefinitions" : [
                                        {
                                                "AttributeName": "email",
                                                "AttributeType": "S"
                                        }
                                ],
                                "GlobalSecondaryIndexes" : [],
                                "KeySchema" : [
                                        {
                                                "AttributeName": "email",
                                                "KeyType": "HASH"
                                        }
                                ],
                                "ProvisionedThroughput" : {
                                        "ReadCapacityUnits": 5,
                                        "WriteCapacityUnits": 5
                                },
                                "TableName" : "player-dev"
                        }
                },

                "EC2SecurityGroup" : {
                        "Type" : "AWS::EC2::SecurityGroup",
                        "Properties" : {
                                "GroupDescription" : "Enable SSH access via port 22",
                                "SecurityGroupIngress" : [
                                        {
                                                "IpProtocol" : "tcp",
                                                "FromPort" : "3000",
                                                "ToPort" : "3000",
                                                "CidrIp" : "0.0.0.0/0"
                                        }
                                ]
                        }
                },

                "AutoScalingGroupLaunchConfiguration": {
                        "Type" : "AWS::AutoScaling::LaunchConfiguration",
                        "Properties" : {
                                "ImageId" : "ami-840910ee",
                                "InstanceMonitoring" : false,
                                "InstanceType" : "t2.micro",
                                "KeyName" : "cloudformation",
                                "SecurityGroups" : [
                                        {
                                                "Ref": "EC2SecurityGroup"
                                        }
                                ]
                        }
                },

                "AutoScalingGroup": {
                        "Type" : "AWS::AutoScaling::AutoScalingGroup",
                        "Properties" : {
                                "AvailabilityZones" :{ "Fn::GetAZs" : "" },
                                "DesiredCapacity" : "1",
                                "HealthCheckType" : "EC2",
                                "LaunchConfigurationName" : { "Ref" : "AutoScalingGroupLaunchConfiguration" },
                                "MaxSize" : "1",
                                "MinSize" : "1"
                        }
                }
        }
}
